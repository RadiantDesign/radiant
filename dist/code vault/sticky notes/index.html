<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
  <link rel="shortcut icon" type="image/png" href="notes.png" />
  <link rel="stylesheet" href="style.css">
  <title>Sticky Notes</title>
</head>
<body>

  <div id="modal">
    <div id="inner_modal">
      <textarea placeholder="Note..." id="user_input" maxlength="160"></textarea>
      <i class="far fa-times-circle" id="hide"></i>
    </div>
  </div>
  
  <main>
    <header>
      <div class="container">
        <div id="header">
          <h1><i class="fas fa-sticky-note"></i> Sticky Notes</h1>
          <button id="add_note">Add Note</button>
        </div>
      </div>
    </header>
    
    <section>
      <div class="container">
        <div id="all_notes"></div>
      </div>
    </section>
  </main>
  
  <script>
    var random_margin = ["-5px", "1px", "5px", "10px", "7px"];
    var random_colors = ["#c2ff3d","#ff3de8","#3dc2ff","#04e022","#bc83e6","#ebb328"];
    var random_degree = ["rotate(3deg)", "rotate(1deg)", "rotate(-1deg)", "rotate(-3deg)", "rotate(-5deg)", "rotate(-8deg)"];
    var index = 0;

    window.onload = function() {
      showNotesFromLocalStorage();
      document.querySelector("#user_input").select();
    };

    document.querySelector("#add_note").addEventListener("click", () => {
      toggleNoteInput();
    });

    document.querySelector("#hide").addEventListener("click", () => {
      toggleNoteInput();
    });

    document.querySelector("#user_input").addEventListener('keydown', (event) => {
      if(event.key === 'Enter'){
        const text = document.querySelector("#user_input").value;
        createStickyNoteAndSave(text);
        toggleNoteInput();
      }
    });

    function toggleNoteInput() {
      const modal = document.querySelector("#modal");
      if (modal.style.display === "none" || modal.style.display === "") {
        modal.style.display = "block";
        document.querySelector("#user_input").focus();
      } else {
        modal.style.display = "none";
      }
    }

    createStickyNoteAndSave = (text) => {
      createStickyNote(text);
      saveNotesToLocalStorage();
    }

    createStickyNote = (text) => {
      let note = document.createElement("div");
      let details = document.createElement("div");
      let noteText = document.createElement("h1");

      note.className = "note";
      details.className = "details";
      noteText.textContent = text;

      details.appendChild(noteText);
      note.appendChild(details);

      if(index > random_colors.length - 1)
        index = 0;

      note.setAttribute("style", `margin:${random_margin[Math.floor(Math.random() * random_margin.length)]}; background-color:${random_colors[index++]}; transform:${random_degree[Math.floor(Math.random() * random_degree.length)]}`);

      note.addEventListener("dblclick", () => {
        note.remove();
        saveNotesToLocalStorage();
      })

      document.querySelector("#all_notes").appendChild(note);
    }

    function saveNotesToLocalStorage() {
      const notes = document.querySelectorAll('.note h1');
      const notesArray = Array.from(notes).map(note => note.textContent);
      localStorage.setItem('notes', JSON.stringify(notesArray));
    }

    function showNotesFromLocalStorage() {
      const notesData = localStorage.getItem('notes');
      if (notesData) {
        const notesArray = JSON.parse(notesData);
        notesArray.forEach(noteText => {
          createStickyNoteAndSave(noteText);
        });
      }
    }
  </script>
</body>
</html>
